# NagaAgent 4.0

![NagaAgent Logo](https://img.shields.io/badge/NagaAgent-4.0-blue?style=for-the-badge&logo=python&logoColor=white)
![Platform](https://img.shields.io/badge/Platform-Windows%20%7C%20macOS%20%7C%20Linux-green?style=for-the-badge)
![License](https://img.shields.io/badge/License-MIT-yellow?style=for-the-badge)
![Python](https://img.shields.io/badge/Python-3.11-blue?style=for-the-badge&logo=python)
![Status](https://img.shields.io/badge/Status-Active-brightgreen?style=for-the-badge)

![Star History](https://img.shields.io/github/stars/Xxiii8322766509/NagaAgent?style=social)![Forks](https://img.shields.io/github/forks/Xxiii8322766509/NagaAgent?style=social)![Issues](https://img.shields.io/github/issues/Xxiii8322766509/NagaAgent)![Pull Requests](https://img.shields.io/github/issues-pr/Xxiii8322766509/NagaAgent)
![UI é¢„è§ˆ](ui/img/README.jpg)
---

å¿«é€Ÿå…¥é—¨è§†é¢‘ï¼š[https://www.pylindex.top/naga/intro.mp4](https://www.pylindex.top/naga/intro.mp4)
---

**ğŸ æ™ºèƒ½å¯¹è¯åŠ©æ‰‹ | å¤šå¹³å°æ”¯æŒ | ä¸°å¯Œç”Ÿæ€ | æ˜“äºæ‰©å±•**

[åŠŸèƒ½ç‰¹æ€§](#-æ ¸å¿ƒåŠŸèƒ½) â€¢ [å¿«é€Ÿå¼€å§‹](#-å¿«é€Ÿå¼€å§‹) â€¢ [å®‰è£…æŒ‡å—](#-è¯¦ç»†å®‰è£…æŒ‡å—) â€¢ [APIæ–‡æ¡£](#-restful-apiæœåŠ¡) â€¢ [é…ç½®è¯´æ˜](#-é…ç½®è¯´æ˜)

---

### ğŸ¯ é¡¹ç›®äº®ç‚¹

âœ… **ğŸ§  æ™ºèƒ½è®°å¿†**: åŸºäº Neo4j çš„ GRAG çŸ¥è¯†å›¾è°±è®°å¿†ç³»ç»Ÿ  
âœ… **ğŸ”§ ä¸°å¯Œç”Ÿæ€**: æ”¯æŒå¤šç§ MCP æœåŠ¡å’Œ Agent ç³»ç»Ÿ  
âœ… **ğŸ¤ è¯­éŸ³äº¤äº’**: OpenAI å…¼å®¹çš„æµå¼è¯­éŸ³åˆæˆæœåŠ¡  
âœ… **ğŸ–¥ï¸ ç°ä»£ç•Œé¢**: åŸºäº PyQt5 çš„ç‹¬ç«‹å¯¹è¯æ¡†æ¶ˆæ¯æ¸²æŸ“ç³»ç»Ÿ  
âœ… **ğŸ­ Live2Dé›†æˆ**: ç‹¬ç«‹çš„Live2Dæ¨¡å—ï¼Œæ”¯æŒæ¨¡å‹å’Œå›¾ç‰‡çš„æ··åˆä¾§æ æ˜¾ç¤º  
âœ… **ğŸŒ å®Œæ•´ API**: FastAPI RESTful API å’Œæµå¼è¾“å‡º  
âœ… **ğŸ“± ç³»ç»Ÿæ‰˜ç›˜**: å®Œæ•´çš„åå°è¿è¡Œå’Œè‡ªå¯åŠ¨æ”¯æŒ  
âœ… **ğŸ” æ™ºèƒ½ä»£ç†**: åŠ¨æ€æœåŠ¡å‘ç°å’Œçƒ­æ’æ‹”ç®¡ç†  
âœ… **ğŸ›¡ï¸ å®‰å…¨å¯é **: ä¼šè¯éš”ç¦»å’Œæƒé™ç®¡ç†  
âœ… **ğŸ¤– å¤šAgentåä½œ**: AgentManager ç‹¬ç«‹ç³»ç»Ÿæ”¯æŒå¤šAgentåä½œ  
âœ… **ğŸŒ³ æ·±åº¦æ€è€ƒ**: åŸºäºé—ä¼ ç®—æ³•çš„å¤šåˆ†æ”¯æ€è€ƒå¼•æ“  
âœ… **ğŸ”„ é…ç½®çƒ­æ›´æ–°**: å®æ—¶é…ç½®å˜æ›´ï¼Œæ— éœ€é‡å¯åº”ç”¨  
âœ… **ğŸ’¾ æŒä¹…åŒ–ä¸Šä¸‹æ–‡**: é‡å¯åè‡ªåŠ¨æ¢å¤å†å²å¯¹è¯ä¸Šä¸‹æ–‡  
âœ… **ğŸ”§ ç³»ç»Ÿæ£€æµ‹**: å†…ç½®å®Œæ•´çš„ç³»ç»Ÿç¯å¢ƒæ£€æµ‹å’Œä¾èµ–éªŒè¯åŠŸèƒ½  

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ğŸ“‹ ç³»ç»Ÿè¦æ±‚

- **æ“ä½œç³»ç»Ÿ**: Windows 10/11, macOS 10.15+, Linux
- **Python**: 3.11
- **å†…å­˜**: å»ºè®® 4GB ä»¥ä¸Š
- **å­˜å‚¨**: å»ºè®® 2GB ä»¥ä¸Šå¯ç”¨ç©ºé—´

### ğŸ”§ ä¸€é”®å®‰è£…

#### ğŸ“¦ ä¾èµ–ç®¡ç†å·¥å…·

NagaAgent 4.0 æä¾›äº†å¼ºå¤§çš„ä¾èµ–ç®¡ç†å·¥å…·ï¼Œæ”¯æŒï¼š

- **ğŸ” è‡ªåŠ¨æ‰«æ**: æ‰«æé¡¹ç›®æ‰€æœ‰ä¾èµ–æ–‡ä»¶ï¼ŒåŒ…æ‹¬ä¸»ä¾èµ–å’Œå„å­æ¨¡å—ä¾èµ–
- **ğŸ“Š ä¾èµ–åˆ†æ**: æŒ‰ç±»åˆ«ç»„ç»‡ä¾èµ–ï¼ˆæ ¸å¿ƒã€GUIã€è¯­éŸ³ã€AIã€ç½‘ç»œã€ç³»ç»Ÿæ§åˆ¶ç­‰ï¼‰
- **âœ… çŠ¶æ€æ£€æµ‹**: è‡ªåŠ¨æ£€æµ‹å·²å®‰è£…å’Œç¼ºå¤±çš„ä¾èµ–
- **ğŸ› ï¸ ä¸€é”®å®‰è£…**: ç”ŸæˆPowerShellå®‰è£…è„šæœ¬å’Œåˆå¹¶çš„requirementsæ–‡ä»¶
- **âš ï¸ å†²çªæ£€æµ‹**: æ£€æµ‹ä¾èµ–ç‰ˆæœ¬å†²çªå’Œå…¼å®¹æ€§é—®é¢˜

**ä½¿ç”¨æ–¹æ³•ï¼š**
```bash
# è¿è¡Œä¾èµ–ç®¡ç†å·¥å…·
python dependency_manager.py

# æŸ¥çœ‹ä¾èµ–çŠ¶æ€
python dependency_manager.py --check

# ç”Ÿæˆå®‰è£…è„šæœ¬
python dependency_manager.py --generate-script

# éªŒè¯ä¾èµ–å®‰è£…
python dependency_manager.py --validate
```

**ç”Ÿæˆçš„æ–‡ä»¶ï¼š**
- `install_dependencies.ps1` - PowerShellä¸€é”®å®‰è£…è„šæœ¬
- `requirements_merged.txt` - åˆå¹¶çš„ä¾èµ–æ–‡ä»¶
- `requirements_clean.txt` - æ¸…ç†åçš„ä¾èµ–æ–‡ä»¶

<details>
<summary><strong>Windows ç”¨æˆ·</strong></summary>

```powershell
# å…‹éš†é¡¹ç›®
git clone https://github.com/Xxiii8322766509/NagaAgent.git
cd NagaAgent

# ä½¿ç”¨ä¾èµ–ç®¡ç†å·¥å…·
python dependency_manager.py

# æˆ–ä½¿ç”¨ä¸€é”®é…ç½®
.\setup.ps1
```
</details>

<details>
<summary><strong>macOS ç”¨æˆ·</strong></summary>

```bash
# å…‹éš†é¡¹ç›®
git clone https://github.com/Xxiii8322766509/NagaAgent.git
cd NagaAgent

# ä¸€é”®é…ç½®
chmod +x setup_mac.sh
./setup_mac.sh
```
</details>

<details>
<summary><strong>Linux ç”¨æˆ·</strong></summary>

```bash
# å…‹éš†é¡¹ç›®
git clone https://github.com/Xxiii8322766509/NagaAgent.git
cd NagaAgent

# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python3 -m venv .venv
source .venv/bin/activate

# å®‰è£…ä¾èµ–
pip install -r requirements.txt
```
</details>

### ğŸ—„ï¸ å¯åŠ¨ Neo4j æœåŠ¡

```bash
# å¯åŠ¨ Neo4j å®¹å™¨
docker run -d \
  --restart always \
  --publish=7474:7474 \
  --publish=7687:7687 \
  --env NEO4J_AUTH=neo4j/your_password \
  --volume=neo4j_data:/data \
  neo4j:latest
```

> **ç«¯å£å†²çªè§£å†³**: å¦‚æœç«¯å£è¢«å ç”¨ï¼Œå¯ä»¥ä½¿ç”¨å…¶ä»–ç«¯å£ï¼š
> ```bash
> --publish=8474:7474 --publish=8687:7687
> ```

### âš™ï¸ é…ç½®æ–‡ä»¶

1. å¤åˆ¶é…ç½®æ¨¡æ¿ï¼š
   ```bash
   cp config.json.example config.json
   ```

2. ç¼–è¾‘é…ç½®æ–‡ä»¶ï¼Œè®¾ç½®APIå¯†é’¥å’Œå…¶ä»–å‚æ•°

### ğŸš€ å¯åŠ¨åº”ç”¨

<details>
<summary><strong>Windows å¯åŠ¨æ–¹å¼</strong></summary>

```powershell
# æ‰˜ç›˜æ¨¡å¼
.\start_with_tray.bat
```
</details>

<details>
<summary><strong>macOS å¯åŠ¨æ–¹å¼</strong></summary>

```bash
./start_mac.sh
```
</details>

<details>
<summary><strong>Linux å¯åŠ¨æ–¹å¼</strong></summary>

```bash
./start.sh
```
</details>

å¯åŠ¨åå°†è‡ªåŠ¨å¼€å¯ï¼š
- ğŸ–¥ï¸ PyQt5 å›¾å½¢ç•Œé¢
- ğŸŒ RESTful API æœåŠ¡å™¨
- ğŸ¤ è¯­éŸ³äº¤äº’æœåŠ¡
- ğŸ§  GRAG çŸ¥è¯†å›¾è°±è®°å¿†ç³»ç»Ÿ
- ğŸ”„ é…ç½®çƒ­æ›´æ–°ç³»ç»Ÿ

---

## ğŸ“ é¡¹ç›®ç»“æ„

NagaAgent 4.0é‡‡ç”¨æ¨¡å—åŒ–æ¶æ„è®¾è®¡ï¼Œå„åŠŸèƒ½æ¨¡å—ç‹¬ç«‹ä¸”å¯æ‰©å±•ï¼š

```
NagaAgent/
â”œâ”€â”€ ğŸ“ apiserver/              # APIæœåŠ¡å™¨æ¨¡å—
â”‚   â”œâ”€â”€ api_server.py          # FastAPIæœåŠ¡å™¨
â”‚   â”œâ”€â”€ streaming_tool_extractor.py  # æµå¼å·¥å…·è°ƒç”¨æå–å™¨
â”‚   â””â”€â”€ tool_call_utils.py     # å·¥å…·è°ƒç”¨å·¥å…·ç±»
â”œâ”€â”€ ğŸ“ system/                 # ç³»ç»Ÿæ ¸å¿ƒæ¨¡å—
â”‚   â”œâ”€â”€ system_checker.py      # ç³»ç»Ÿç¯å¢ƒæ£€æµ‹å™¨
â”‚   â”œâ”€â”€ config_manager.py      # é…ç½®ç®¡ç†å™¨
â”‚   â””â”€â”€ (å·²è¿ç§»åˆ°apiserver)   # å¯¹è¯æ ¸å¿ƒå¼•æ“
â”œâ”€â”€ ğŸ“ ui/                     # ç”¨æˆ·ç•Œé¢æ¨¡å—
â”‚   â”œâ”€â”€ live2d/                # Live2Dé›†æˆæ¨¡å—
â”‚   â”‚   â”œâ”€â”€ renderer.py        # Live2Dæ¸²æŸ“å™¨
â”‚   â”‚   â”œâ”€â”€ animator.py        # åŠ¨ç”»ç³»ç»Ÿ
â”‚   â”‚   â””â”€â”€ widget.py          # Live2Dç»„ä»¶
â”‚   â”œâ”€â”€ live2d_side_widget.py  # Live2Dä¾§æ å®¹å™¨
â”‚   â”œâ”€â”€ pyqt_chat_window.py    # ä¸»èŠå¤©çª—å£
â”‚   â””â”€â”€ message_renderer.py    # æ¶ˆæ¯æ¸²æŸ“å™¨
â”œâ”€â”€ ğŸ“ voice/                  # è¯­éŸ³å¤„ç†æ¨¡å—
â”‚   â”œâ”€â”€ input/                 # è¯­éŸ³è¾“å…¥æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ server.py          # ASRæœåŠ¡å™¨
â”‚   â”‚   â”œâ”€â”€ vad_worker.py      # VADç«¯ç‚¹æ£€æµ‹
â”‚   â”‚   â””â”€â”€ asr_client.py      # ASRå®¢æˆ·ç«¯
â”‚   â””â”€â”€ output/                # è¯­éŸ³è¾“å‡ºæœåŠ¡
â”‚       â”œâ”€â”€ tts_handler.py     # TTSå¤„ç†å™¨
â”‚       â””â”€â”€ voice_integration.py # è¯­éŸ³é›†æˆ
â”œâ”€â”€ ğŸ“ mcpserver/              # MCPæœåŠ¡æ¨¡å—
â”‚   â”œâ”€â”€ agent_manager.py       # Agentç®¡ç†å™¨
â”‚   â”œâ”€â”€ agent_*/               # å„ç§AgentæœåŠ¡
â”‚   â””â”€â”€ mcp_manager.py         # MCPç®¡ç†å™¨
â”œâ”€â”€ ğŸ“ thinking/               # æ€è€ƒå¼•æ“æ¨¡å—
â”‚   â”œâ”€â”€ tree_thinking.py       # æ ‘å½¢æ€è€ƒå¼•æ“
â”‚   â”œâ”€â”€ genetic_pruning.py     # é—ä¼ ç®—æ³•å‰ªæ
â”‚   â””â”€â”€ thinking_node.py       # æ€è€ƒèŠ‚ç‚¹
â”œâ”€â”€ ğŸ“ summer_memory/          # è®°å¿†ç³»ç»Ÿæ¨¡å—
â”‚   â”œâ”€â”€ memory_manager.py      # è®°å¿†ç®¡ç†å™¨
â”‚   â”œâ”€â”€ quintuple_extractor.py # äº”å…ƒç»„æå–å™¨
â”‚   â””â”€â”€ graph.py               # å›¾æ•°æ®åº“æ“ä½œ
â”œâ”€â”€ ğŸ“ logs/                   # æ—¥å¿—å’Œå­˜å‚¨
â”‚   â””â”€â”€ knowledge_graph/       # çŸ¥è¯†å›¾è°±æ•°æ®
â”œâ”€â”€ ğŸ“ system/prompts/         # æç¤ºè¯å­˜å‚¨ï¼ˆå·²è¿ç§»åˆ°systemç›®å½•ï¼Œç®¡ç†åŠŸèƒ½é›†æˆåˆ°config.pyï¼‰
â”œâ”€â”€ ğŸ“ mqtt_tool/              # MQTTé€šä¿¡å·¥å…·
â”œâ”€â”€ ğŸ“ ui/tray/                # ç³»ç»Ÿæ‰˜ç›˜æ¨¡å—
â””â”€â”€ ğŸ“„ main.py                 # ä¸»ç¨‹åºå…¥å£
```

**æ ¸å¿ƒæ¨¡å—è¯´æ˜ï¼š**
- **system/**: ç³»ç»Ÿæ ¸å¿ƒåŠŸèƒ½ï¼ŒåŒ…æ‹¬ç¯å¢ƒæ£€æµ‹ã€é…ç½®ç®¡ç†ã€å¯¹è¯å¼•æ“
- **ui/**: ç”¨æˆ·ç•Œé¢ï¼Œæ”¯æŒLive2Dã€PyQt5ã€ç³»ç»Ÿæ‰˜ç›˜ç­‰
- **voice/**: è¯­éŸ³å¤„ç†ï¼Œåˆ†ç¦»è¾“å…¥/è¾“å‡ºï¼Œæ”¯æŒASRå’ŒTTS
- **mcpserver/**: MCPæœåŠ¡ç”Ÿæ€ï¼Œæ”¯æŒå¤šç§Agentå’Œå·¥å…·
- **thinking/**: æ™ºèƒ½æ€è€ƒå¼•æ“ï¼Œæ”¯æŒå¤šåˆ†æ”¯æ¨ç†
- **summer_memory/**: çŸ¥è¯†å›¾è°±è®°å¿†ç³»ç»Ÿï¼ŒåŸºäºNeo4j

---

## ğŸ› ï¸ è¯¦ç»†å®‰è£…æŒ‡å—

### ğŸ“¦ ä¾èµ–æ•´åˆè¯´æ˜

NagaAgent 4.0 å·²å°†æ ¸å¿ƒä¾èµ–å’ŒAPIæœåŠ¡å™¨ç›¸å…³ä¾èµ–æ•´åˆåˆ° `nagaagent-core` åŒ…ä¸­ï¼Œä»¥å‡å°‘ä¾èµ–ä¸‹è½½è´Ÿæ‹…ï¼š

**å·²æ•´åˆçš„ä¾èµ–åŒ…ï¼š**
- **æ ¸å¿ƒä¾èµ–**: `mcp`, `openai`, `python-dotenv`, `requests`, `aiohttp`
- **APIæœåŠ¡å™¨ä¾èµ–**: `flask`, `gevent`, `fastapi`, `uvicorn`

**å®‰è£…æ–¹å¼ï¼š**
```bash
# è‡ªåŠ¨å®‰è£… nagaagent-core åŒ…ï¼ˆåŒ…å«æ‰€æœ‰æ ¸å¿ƒä¾èµ–ï¼‰
pip install -r requirements.txt
```

**ä¼˜åŠ¿ï¼š**
- âœ… å‡å°‘ä¾èµ–ä¸‹è½½æ—¶é—´
- âœ… ç»Ÿä¸€ç‰ˆæœ¬ç®¡ç†
- âœ… ç®€åŒ–å®‰è£…æµç¨‹
- âœ… æé«˜ç¨³å®šæ€§

### ğŸ” ç³»ç»Ÿç¯å¢ƒæ£€æµ‹

NagaAgent 4.0 å†…ç½®äº†å®Œæ•´çš„ç³»ç»Ÿç¯å¢ƒæ£€æµ‹åŠŸèƒ½ï¼Œè‡ªåŠ¨æ£€æµ‹Pythonç‰ˆæœ¬ã€è™šæ‹Ÿç¯å¢ƒã€ä¾èµ–åŒ…ç­‰ï¼š

```bash
# è¿è¡Œç³»ç»Ÿç¯å¢ƒæ£€æµ‹
python -c "from system.system_checker import SystemChecker; SystemChecker().check_all()"

# æˆ–è€…é€šè¿‡ä¸»ç¨‹åºè‡ªåŠ¨æ£€æµ‹
python main.py --check-env
```

**æ£€æµ‹é¡¹ç›®åŒ…æ‹¬ï¼š**
- âœ… Pythonç‰ˆæœ¬å…¼å®¹æ€§æ£€æŸ¥
- âœ… è™šæ‹Ÿç¯å¢ƒçŠ¶æ€æ£€æµ‹
- âœ… æ ¸å¿ƒä¾èµ–åŒ…å®Œæ•´æ€§éªŒè¯
- âœ… å¯é€‰ä¾èµ–åŒ…å¯ç”¨æ€§æ£€æŸ¥
- âœ… é…ç½®æ–‡ä»¶æ ¼å¼éªŒè¯
- âœ… ç›®å½•ç»“æ„å®Œæ•´æ€§æ£€æŸ¥
- âœ… æ–‡ä»¶æƒé™å’Œè®¿é—®æ€§æµ‹è¯•
- âœ… ç³»ç»Ÿèµ„æºä½¿ç”¨æƒ…å†µç›‘æ§

### ğŸ“¦ ä¾èµ–è¯´æ˜

é¡¹ç›®ä¾èµ–ä¸»è¦åŒ…æ‹¬ï¼š

| ç±»åˆ« | ä¾èµ–åŒ… | ç”¨é€” |
|------|--------|------|
| **æ ¸å¿ƒæ¡†æ¶** | `openai`, `mcp`, `fastapi` | AIå¯¹è¯å’ŒAPIæœåŠ¡ |
| **æœç´¢å·¥å…·** | `langchain-community` | SearXNGæœç´¢é›†æˆ |
| **GUIç•Œé¢** | `PyQt5`, `pygame` | å›¾å½¢ç”¨æˆ·ç•Œé¢ |
| **è¯­éŸ³å¤„ç†** | `edge-tts`, `pyaudio`, `sounddevice` | è¯­éŸ³åˆæˆå’Œè¯†åˆ« |
| **çŸ¥è¯†å›¾è°±** | `py2neo`, `pyvis`, `matplotlib` | Neo4jå›¾æ•°æ®åº“æ“ä½œ |
| **æµè§ˆå™¨è‡ªåŠ¨åŒ–** | `playwright` | ç½‘é¡µæ“ä½œè‡ªåŠ¨åŒ– |
| **MCPå·¥å…·** | `jmcomic`, `fastmcp` | å¤šç§æ‰©å±•å·¥å…· |
| **ç³»ç»Ÿæ§åˆ¶** | `pycaw`, `screen-brightness-control` | ç³»ç»ŸåŠŸèƒ½æ§åˆ¶ |
| **é€šä¿¡åè®®** | `paho-mqtt`, `websockets` | MQTTå’ŒWebSocketé€šä¿¡ |
| **æ•°æ®å¤„ç†** | `numpy`, `pandas`, `scikit-learn` | æ•°æ®å¤„ç†å’Œæœºå™¨å­¦ä¹  |
| **æ–‡æ¡£å¤„ç†** | `python-docx` | Wordæ–‡æ¡£å¤„ç† |

### âš ï¸ å¸¸è§é—®é¢˜è§£å†³

<details>
<summary><strong>Windows å®‰è£…é—®é¢˜</strong></summary>

**C++ ç¼–è¯‘å·¥å…·ç¼ºå¤±ï¼š**
```powershell
# ä¸‹è½½å¹¶å®‰è£… Microsoft Visual C++ Build Tools
# https://visualstudio.microsoft.com/visual-cpp-build-tools/
```

**Numpy è­¦å‘Šå¹¶ä¸”ç¨‹åºå´©æºƒï¼š**
```powershell
# å®‰è£… Visual Studio åï¼Œåœ¨ Developer Command Prompt ä¸­æ‰§è¡Œ
uv pip uninstall numpy
uv sync --no-cache --reinstall
```

**æƒé™é—®é¢˜ï¼š**
```powershell
# ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œ PowerShell
Set-ExecutionPolicy RemoteSigned -Scope CurrentUser
```
</details>

<details>
<summary><strong>macOS å®‰è£…é—®é¢˜</strong></summary>

**Python ç‰ˆæœ¬è¿‡ä½ï¼š**
```bash
brew install python@3.11
echo 'export PATH="/usr/local/opt/python@3.11/bin:$PATH"' >> ~/.zshrc
```

**PyAudio å®‰è£…å¤±è´¥ï¼š**
```bash
brew install portaudio
pip install pyaudio
```

**æƒé™é—®é¢˜ï¼š**
```bash
chmod +x *.sh
```
</details>

<details>
<summary><strong>Linux å®‰è£…é—®é¢˜</strong></summary>

**ç³»ç»Ÿä¾èµ–ï¼š**
```bash
# Ubuntu/Debian
sudo apt update
sudo apt install python3-dev portaudio19-dev

# CentOS/RHEL
sudo yum install python3-devel portaudio-devel
```

**Docker æƒé™ï¼š**
```bash
sudo usermod -aG docker $USER
newgrp docker
```
</details>

---

## âš™ï¸ é…ç½®è¯´æ˜

### ğŸ”„ é…ç½®çƒ­æ›´æ–°ç³»ç»Ÿ

NagaAgent 4.0 å¼•å…¥äº†å¼ºå¤§çš„é…ç½®çƒ­æ›´æ–°ç³»ç»Ÿï¼Œæ”¯æŒå®æ—¶é…ç½®å˜æ›´è€Œæ— éœ€é‡å¯åº”ç”¨ã€‚

#### æ ¸å¿ƒç‰¹æ€§
- **å®æ—¶æ›´æ–°**: é…ç½®å˜æ›´ç«‹å³ç”Ÿæ•ˆï¼Œæ— éœ€é‡å¯
- **é…ç½®å¿«ç…§**: æ”¯æŒé…ç½®çš„ä¿å­˜å’Œæ¢å¤
- **è‡ªåŠ¨ç›‘è§†**: è‡ªåŠ¨æ£€æµ‹é…ç½®æ–‡ä»¶å˜åŒ–
- **æ¨¡å—é‡è½½**: æ”¯æŒåŠ¨æ€æ¨¡å—é‡æ–°åŠ è½½
- **é”™è¯¯å¤„ç†**: å®Œå–„çš„å¼‚å¸¸å¤„ç†æœºåˆ¶

#### ä½¿ç”¨æ–¹æ³•

```python
from config_manager import update_config, get_config_snapshot

# æ›´æ–°é…ç½®
success = update_config({
    "system": {"debug": True},
    "api": {"temperature": 0.8}
})

# è·å–é…ç½®å¿«ç…§
snapshot = get_config_snapshot()

# æ¢å¤é…ç½®
restore_config_snapshot(snapshot)
```

#### è¯¦ç»†æ–‡æ¡£
- ğŸ“– [é…ç½®çƒ­æ›´æ–°ä½¿ç”¨æŒ‡å—](CONFIG_HOT_RELOAD_GUIDE.md)
- ğŸ“Š [é…ç½®çƒ­æ›´æ–°æµ‹è¯•æŠ¥å‘Š](CONFIG_HOT_RELOAD_TEST_REPORT.md)

### API é…ç½®
ä¿®æ”¹ `config.json` æ–‡ä»¶ä¸­çš„ `api` éƒ¨åˆ†ï¼š
```json
{
  "api": {
    "api_key": "your-api-key-here",
    "base_url": "https://api.deepseek.com/v1",
    "model": "deepseek-chat",
    "temperature": 0.7,
    "max_tokens": 10000,
    "max_history_rounds": 10,
    "persistent_context": true,
    "context_load_days": 3,
    "context_parse_logs": true
  }
}
```

#### æŒä¹…åŒ–ä¸Šä¸‹æ–‡é…ç½®è¯´æ˜
- **persistent_context**: æ˜¯å¦å¯ç”¨æŒä¹…åŒ–ä¸Šä¸‹æ–‡åŠŸèƒ½ï¼ˆé»˜è®¤ï¼štrueï¼‰
- **context_load_days**: ä»æœ€è¿‘å‡ å¤©çš„æ—¥å¿—æ–‡ä»¶ä¸­åŠ è½½å†å²å¯¹è¯ï¼ˆé»˜è®¤ï¼š3å¤©ï¼‰
- **context_parse_logs**: æ˜¯å¦ä»æ—¥å¿—æ–‡ä»¶è§£æä¸Šä¸‹æ–‡ï¼ˆé»˜è®¤ï¼štrueï¼‰

**å‰ç«¯å†å²è®°å½•æ˜¾ç¤º**: å¯ç”¨æŒä¹…åŒ–ä¸Šä¸‹æ–‡åï¼Œé‡å¯åº”ç”¨æ—¶å‰ç«¯UIä¼šè‡ªåŠ¨åŠ è½½å¹¶æ˜¾ç¤ºå†å²èŠå¤©è®°å½•ï¼Œæ— éœ€æ‰‹åŠ¨æ“ä½œã€‚

### APIæœåŠ¡å™¨é…ç½®
```json
{
  "api_server": {
    "enabled": true,
    "host": "127.0.0.1",
    "port": 8000,
    "auto_start": true,
    "docs_enabled": true
  }
}
```

### åœ¨çº¿æœç´¢é…ç½®
```json
{
  "online_search": {
    "searxng_url": "https://searxng.pylindex.top",
    "engines": ["google"],
    "num_results": 5
  }
}
```

### GRAGçŸ¥è¯†å›¾è°±è®°å¿†ç³»ç»Ÿé…ç½®
```json
{
  "grag": {
    "enabled": true,
    "auto_extract": true,
    "context_length": 5,
    "similarity_threshold": 0.6,
    "neo4j_uri": "neo4j://127.0.0.1:7687",
    "neo4j_user": "neo4j",
    "neo4j_password": "your_password",
    "neo4j_database": "neo4j"
  }
}
```

### Live2Dé›†æˆé…ç½®
```json
{
  "live2d": {
    "enabled": true,
    "model_path": "path/to/your/model.model3.json",
    "fallback_image": "ui/img/standby.png"
  }
}
```

#### Live2Dæ¨¡å—ç‰¹æ€§
- **ç‹¬ç«‹æ¨¡å—è®¾è®¡**: ä¸ä¾èµ–å¤–éƒ¨Live2Dé¡¹ç›®ï¼Œå®Œå…¨è‡ªä¸»å®ç°
- **å®Œæ•´åŠ¨ç”»ç³»ç»Ÿ**: æ”¯æŒçœ¨çœ¼ã€çœ¼çƒè·Ÿè¸ªã€èº«ä½“æ‘†åŠ¨ã€å‘¼å¸ã€æƒ…ç»ªç­‰åŠ¨ç”»
- **è‡ªåŠ¨å›é€€æœºåˆ¶**: Live2Dä¸å¯ç”¨æ—¶è‡ªåŠ¨åˆ‡æ¢åˆ°å›¾ç‰‡æ¨¡å¼
- **é¼ æ ‡äº¤äº’**: æ”¯æŒç‚¹å‡»è§¦å‘åŠ¨ä½œå’Œçœ¼çƒè·Ÿè¸ª
- **èµ„æºç®¡ç†**: å®Œæ•´çš„èµ„æºåŠ è½½å’Œæ¸…ç†æœºåˆ¶

#### Live2Dæ¨¡å—ç»“æ„
```
ui/live2d/
â”œâ”€â”€ __init__.py          # æ¨¡å—åˆå§‹åŒ–
â”œâ”€â”€ renderer.py          # Live2Dæ¸²æŸ“å™¨
â”œâ”€â”€ animator.py          # åŠ¨ç”»ç³»ç»Ÿ
â”œâ”€â”€ widget.py            # Live2D Widgetç»„ä»¶
â””â”€â”€ README.md            # è¯¦ç»†æ–‡æ¡£
```

#### Live2Dé…ç½®è¯´æ˜
- **enabled**: æ˜¯å¦å¯ç”¨Live2DåŠŸèƒ½
- **model_path**: Live2Dæ¨¡å‹æ–‡ä»¶è·¯å¾„ï¼ˆ.model3.jsonæ ¼å¼ï¼‰
- **fallback_image**: å›é€€å›¾ç‰‡è·¯å¾„ï¼ˆLive2Dä¸å¯ç”¨æ—¶ä½¿ç”¨ï¼‰

### è·å– API å¯†é’¥
1. è®¿é—®å¯¹åº”çš„LLMæœåŠ¡å•†å®˜ç½‘ï¼ˆå¦‚DeepSeekã€OpenAIç­‰ï¼‰
2. æ³¨å†Œè´¦å·å¹¶åˆ›å»º API å¯†é’¥
3. å°†å¯†é’¥å¡«å…¥ `config.json` æ–‡ä»¶çš„ `api.api_key` å­—æ®µ

---

## ğŸŒŸ æ ¸å¿ƒåŠŸèƒ½

### ğŸ§  Serveræ¶æ„ä¸å¹¶è¡Œå¯åŠ¨

å››é¡¹ Server èŒè´£æ¸…æ™°ã€å¹¶è¡Œå¯åŠ¨ã€ç›¸äº’è§£è€¦ä½†æœ‰åºåä½œï¼š

1) API Serverï¼ˆFastAPIï¼Œé»˜è®¤ 8000ï¼‰
   - èŒè´£ï¼š
     - å¯¹å¤– REST API ä¸æµå¼ SSE æ¥å£
     - ä½¿ç”¨ `streaming_tool_extractor` ä»…åšå¥å­çº§åˆ‡å‰²å¹¶æŠ•é€’ç»™è¯­éŸ³ä¾§ï¼ˆå‰ç«¯ç›´æ¥ append å¢é‡ï¼Œä¸å†æ¥æ”¶åˆ†å¥äº‹ä»¶ï¼‰
     - ä¼šè¯ç®¡ç†ä¸æ—¥å¿—è®°å½•ï¼ˆ`message_manager`ï¼‰
     - ä¸å‘ `naga_system_prompt` æ³¨å…¥ MCP æœåŠ¡æ¸…å•ï¼Œä¸»å¯¹è¯æµç¨‹ä¿æŒçº¯å‡€
   - å…³é”®æ¥å£ï¼ˆç¤ºä¾‹ï¼‰ï¼š
     - `/chat` æ™®é€šå¯¹è¯ï¼›`/chat/stream` æµå¼å¯¹è¯ï¼ˆç›´æ¥ä¸‹å‘ `content` å¢é‡ï¼‰
     - `/health`ã€`/system/info`ï¼ˆå«å¯ç”¨ MCP æœåŠ¡ç»Ÿè®¡ï¼‰
     - ä¼šè¯ç®¡ç†ï¼š`/sessions`ã€`/sessions/{id}`ã€`DELETE /sessions*`
   - ç›¸å…³å®ç°ï¼š`apiserver/api_server.py`

2) Agent Serverï¼ˆFastAPIï¼Œé»˜è®¤ 8001ï¼‰
   - èŒè´£ï¼š
     - æ„å›¾è¯†åˆ«ä¸ä»»åŠ¡ç¼–æ’ä¸­æ¢ï¼ˆåå°å¼‚æ­¥è§¦å‘ï¼Œä¸é˜»å¡å‰å°å¯¹è¯ï¼‰
     - è¿è¡Œ MCP å·¥å…·è°ƒç”¨å¾ªç¯ï¼š`_run_intent_mcp_loop(session_id, messages, initial_analysis, max_iterations=2)`
       - è§£ææ„å›¾è¯†åˆ«äº§å‡ºçš„ `tool_calls`
       - é€æ¡è°ƒåº¦è‡³ MCPï¼ˆè§ MCP Serverï¼‰ï¼Œç»“æœå›çŒåˆ°ä¸Šä¸‹æ–‡ï¼Œå†æ¬¡è¿­ä»£è¯†åˆ«
     - ç”µè„‘æ§åˆ¶ã€èƒ½åŠ›åˆ·æ–°ã€ä»»åŠ¡åˆ—è¡¨ä¸çŠ¶æ€æŸ¥è¯¢ç­‰ï¼ˆåŸºäºåšå¼ˆè®ºçš„è°ƒåº¦å™¨ï¼‰
   - å…³é”®æ¥å£ï¼ˆç¤ºä¾‹ï¼‰ï¼š`/tasks`ã€`/tasks/{id}`ã€`/capabilities`ã€`/mcp/availability`ã€`/computer-use/*`
   - ç›¸å…³å®ç°ï¼š`agentserver/agent_server.py`ã€`agentserver/task_scheduler.py`
   - ä»»åŠ¡è°ƒåº¦å™¨ç”¨æ³•ç¤ºä¾‹ï¼š
     ```python
     from agentserver.task_scheduler import get_task_scheduler

     scheduler = get_task_scheduler()
     tasks = [
         {"type": "processor", "params": {"query": "ç¤ºä¾‹ä»»åŠ¡A"}},
         {"type": "processor", "params": {"query": "ç¤ºä¾‹ä»»åŠ¡B"}},
     ]
     results = await scheduler.schedule_parallel_execution(tasks)

     # ç»Ÿè®¡ï¼ˆä¸ agentserver/agent_manager.py çš„ get_execution_stats å¯¹é½ï¼‰
     total = len(scheduler.task_registry)
     running = len([t for t in scheduler.task_registry.values() if t.get("status") == "running"])
     queued = len([t for t in scheduler.task_registry.values() if t.get("status") == "queued"])
     ```
   - è¿ç§»æç¤ºï¼šåŸ `apiserver.task_scheduler` å·²ç»Ÿä¸€ä¸º `agentserver.task_scheduler`

3) MCP Serverï¼ˆFastAPIï¼Œé»˜è®¤ 8003ï¼‰
   - èŒè´£ï¼š
     - å”¯ä¸€ MCP å·¥å…·æ‰§è¡Œé€šé“ä¸è°ƒåº¦å±‚
     - é€šè¿‡ `mcp_scheduler` â†’ `mcp_manager.unified_call(service, tool, args)` æ‰§è¡Œå•æ¬¡å·¥å…·è°ƒç”¨
     - ä»¥ `mcp_registry` ä¸ºå”¯ä¸€èƒ½åŠ›å…ƒæ•°æ®æ¥æºï¼Œå·²ç§»é™¤å†—ä½™ `MCPCapabilityManager` ä¸é‡å¤æ‰§è¡Œå…¥å£
   - ç‰¹æ€§ï¼š
     - æ”¯æŒæœåŠ¡/å·¥å…·åˆ—è¡¨ã€ç»Ÿè®¡ã€èƒ½åŠ›æŸ¥è¯¢ï¼ˆè¯¦è§ `mcpserver/mcp_server.py` æš´éœ²çš„ APIï¼‰
     - ä¸ Agent Server ç´§å¯†ååŒï¼šAgent çš„å·¥å…·è°ƒç”¨å¾ªç¯é€šè¿‡æ­¤å¤„ç»Ÿä¸€è½åœ°æ‰§è¡Œ
   - ç›¸å…³å®ç°ï¼š`mcpserver/mcp_server.py`ã€`mcpserver/mcp_scheduler.py`ã€`mcpserver/mcp_manager.py`ã€`mcpserver/mcp_registry.py`

4) TTS Serverï¼ˆHTTPï¼Œç«¯å£è§ `config.tts.port`ï¼‰
   - èŒè´£ï¼š
     - ç‹¬ç«‹è¯­éŸ³è¾“å‡ºæœåŠ¡ï¼Œåªå…³å¿ƒå¥å­çº§æ–‡æœ¬è¾“å…¥ä¸åˆæˆæ’­æ”¾
     - ä¸ API Server çš„åˆ†å·¥ï¼šAPI ä¾§è´Ÿè´£åˆ‡å¥å¹¶æŠ•é€’ï¼ŒTTS è´Ÿè´£éŸ³é¢‘ç”Ÿæˆä¸æ’­æ”¾ï¼ŒäºŒè€…å®Œå…¨è§£è€¦
   - ç›¸å…³å®ç°ï¼š`voice/output/start_voice_service.py`ã€`voice/output/voice_integration.py`

å¹¶è¡Œå¯åŠ¨ä¸ç«¯å£å ç”¨å›é€€ï¼š
- åœ¨ `main.py` ä¸­é€šè¿‡ `ServiceManager.start_all_servers()` å¹¶è¡Œæ‹‰èµ· API/Agent/MCP/TTS å››ä¸ªæœåŠ¡ï¼›
- è‡ªåŠ¨æ£€æµ‹ç«¯å£å ç”¨ï¼Œå·²å ç”¨å³è·³è¿‡å¹¶æ‰“å°æç¤ºï¼Œä¸é˜»å¡å…¶å®ƒæœåŠ¡å¯åŠ¨ï¼›
- çº¿ç¨‹æ–¹å¼åå°è¿è¡Œï¼Œæ˜¾è‘—ç¼©çŸ­æ•´ä½“å¯åŠ¨è€—æ—¶ã€‚

### ğŸ” åœ¨çº¿æœç´¢ç³»ç»Ÿ
- **SearXNGé›†æˆ**: åŸºäº SearXNG çš„éšç§ä¿æŠ¤æœç´¢å¼•æ“
- **å¤šå¼•æ“æ”¯æŒ**: æ”¯æŒGoogleã€Bingç­‰å¤šç§æœç´¢å¼•æ“
- **æ™ºèƒ½ç»“æœå¤„ç†**: è‡ªåŠ¨æ ¼å¼åŒ–æœç´¢ç»“æœï¼Œæä¾›AIå‹å¥½çš„ä¿¡æ¯å±•ç¤º
- **çµæ´»é…ç½®**: å¯é…ç½®æœç´¢å¼•æ“åˆ—è¡¨ã€ç»“æœæ•°é‡ç­‰å‚æ•°

### ğŸ”„ é…ç½®çƒ­æ›´æ–°ç³»ç»Ÿ
- **å®æ—¶é…ç½®æ›´æ–°**: é…ç½®å˜æ›´ç«‹å³ç”Ÿæ•ˆï¼Œæ— éœ€é‡å¯åº”ç”¨
- **é…ç½®å˜æ›´é€šçŸ¥**: å®Œå–„çš„ç›‘å¬å™¨æœºåˆ¶ï¼Œæ”¯æŒé…ç½®å˜æ›´å›è°ƒ
- **æ¨¡å—é‡æ–°åŠ è½½**: æ”¯æŒåŠ¨æ€æ¨¡å—ç®¡ç†å’Œçƒ­æ’æ‹”
- **é…ç½®ç›‘è§†å™¨**: è‡ªåŠ¨æ–‡ä»¶å˜åŒ–æ£€æµ‹å’Œé‡æ–°åŠ è½½
- **é…ç½®å¿«ç…§**: å®‰å…¨çš„é…ç½®ä¿å­˜å’Œæ¢å¤åŠŸèƒ½
- **é”™è¯¯å¤„ç†**: å®Œå–„çš„å¼‚å¸¸å¤„ç†æœºåˆ¶ï¼Œç¡®ä¿ç³»ç»Ÿç¨³å®šæ€§

### ğŸ—ºï¸ GRAG çŸ¥è¯†å›¾è°±
- **äº”å…ƒç»„æå–**: è‡ªåŠ¨ä»å¯¹è¯ä¸­æå–å®ä½“-å…³ç³»-å±æ€§
- **æ™ºèƒ½æ£€ç´¢**: åŸºäºç›¸ä¼¼åº¦çš„ä¸Šä¸‹æ–‡å¬å›æœºåˆ¶
- **å¯è§†åŒ–å±•ç¤º**: æ”¯æŒçŸ¥è¯†å›¾è°±çš„å¯è§†åŒ–å±•ç¤º
- **å†å²å¯¼å…¥**: å…¼å®¹æ—§ç‰ˆå¯¹è¯è®°å½•çš„æ‰¹é‡å¯¼å…¥

### ğŸ–¥ï¸ ç”¨æˆ·ç•Œé¢
- **ç°ä»£åŒ– GUI**: åŸºäº PyQt5 çš„ç²¾ç¾å›¾å½¢ç•Œé¢
- **ç‹¬ç«‹å¯¹è¯æ¡†**: æ¯ä¸ªå¯¹è¯éƒ½æ˜¯ç‹¬ç«‹çš„å¯¹è¯æ¡†ç»„ä»¶ï¼Œé‡‡ç”¨ç›´è§’è®¾è®¡ï¼Œæ”¯æŒè‡ªåŠ¨é«˜åº¦è°ƒæ•´
- **å·¥å…·è°ƒç”¨å¯¹è¯æ¡†**: ä¸“é—¨ä¸ºå·¥å…·è°ƒç”¨è®¾è®¡çš„å¯¹è¯æ¡†ï¼Œæ²¡æœ‰ç”¨æˆ·åæ ‡ç­¾ï¼Œä¿æŒç®€æ´çš„UIé£æ ¼
- **é€æ˜èƒŒæ™¯**: ä¸»èŠå¤©åŒºåŸŸä½¿ç”¨é€æ˜èƒŒæ™¯ï¼Œå¯¹è¯æ¡†ä¿æŒåŸæœ‰æ ·å¼
- **ğŸ­ Live2Dé›†æˆ**: ç‹¬ç«‹çš„Live2Dæ¨¡å—ï¼Œæ”¯æŒæ¨¡å‹å’Œå›¾ç‰‡çš„æ··åˆä¾§æ æ˜¾ç¤ºï¼Œè‡ªåŠ¨å›é€€æœºåˆ¶
- **Markdown æ”¯æŒ**: å®Œæ•´çš„ Markdown è¯­æ³•æ”¯æŒå’Œä»£ç é«˜äº®
- **ä¸»é¢˜å®šåˆ¶**: æ”¯æŒç•Œé¢ä¸»é¢˜ã€é€æ˜åº¦ç­‰è‡ªå®šä¹‰
- **å“åº”å¼è®¾è®¡**: è‡ªé€‚åº”ä¸åŒå±å¹•å°ºå¯¸
- **æµå¼æ›´æ–°**: å®æ—¶æµå¼æ¶ˆæ¯æ›´æ–°å’Œè‡ªåŠ¨æ»šåŠ¨

### ğŸ“± ç³»ç»Ÿæ‰˜ç›˜
- **åå°è¿è¡Œ**: æ”¯æŒæœ€å°åŒ–åˆ°ç³»ç»Ÿæ‰˜ç›˜
- **è‡ªåŠ¨éšè—**: å¯åŠ¨åè‡ªåŠ¨éšè—æ§åˆ¶å°çª—å£
- **å¿«æ·æ“ä½œ**: æ‰˜ç›˜å›¾æ ‡å³é”®èœå•
- **è‡ªå¯åŠ¨**: æ”¯æŒæ³¨å†Œè¡¨æ–¹å¼çš„è‡ªå¯åŠ¨åŠŸèƒ½

---

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„

<div align="center">

```mermaid
graph TB
    A[ç”¨æˆ·ç•Œé¢] --> B[PyQt5 GUI]
    A --> C[Web API]
    A --> D[è¯­éŸ³äº¤äº’]
    
    B --> E[å¯¹è¯æ ¸å¿ƒ]
    C --> E
    D --> E
    
    E --> F[å·¥å…·è°ƒç”¨å¾ªç¯]
    F --> G[MCP æœåŠ¡ç®¡ç†å™¨]
    F --> H[Agent ç®¡ç†å™¨]
    
    G --> I[å„ç§ MCP æœåŠ¡]
    H --> J[å„ç§ Agent]
    
    E --> K[GRAG è®°å¿†ç³»ç»Ÿ]
    K --> L[Neo4j å›¾æ•°æ®åº“]
    
    E --> M[é…ç½®ç®¡ç†]
    M --> N[config.py]
    M --> O[config_manager.py]
    
    I --> O[æ–‡ä»¶/ä»£ç /æµè§ˆå™¨ç­‰]
    J --> P[ä¸“ä¸šä»»åŠ¡å¤„ç†]
```

</div>

## ğŸ”§ å·¥å…·è°ƒç”¨å¾ªç¯æœºåˆ¶

### ç³»ç»Ÿæ¦‚è¿°
NagaAgentæ”¯æŒä¸¤ç§ç±»å‹çš„å·¥å…·è°ƒç”¨ï¼š
- **MCPæœåŠ¡è°ƒç”¨**: é€šè¿‡`agentType: mcp`è°ƒç”¨MCPç±»å‹çš„Agent
- **AgentæœåŠ¡è°ƒç”¨**: é€šè¿‡`agentType: agent`è°ƒç”¨Agentç±»å‹çš„Agent

### å·¥å…·è°ƒç”¨æ ¼å¼

#### MCPæœåŠ¡è°ƒç”¨æ ¼å¼
```json
{
  "agentType": "mcp",
  "service_name": "MCPæœåŠ¡åç§°",
  "tool_name": "å·¥å…·åç§°",
  "å‚æ•°å": "å‚æ•°å€¼"
}
```

#### AgentæœåŠ¡è°ƒç”¨æ ¼å¼
```json
{
  "agentType": "agent",
  "agent_name": "Agentåç§°",
  "prompt": "ä»»åŠ¡å†…å®¹"
}
```

### å·¥å…·è°ƒç”¨æµç¨‹
1. **LLMè¾“å‡ºJSONæ ¼å¼**: LLMæ ¹æ®ç”¨æˆ·éœ€æ±‚è¾“å‡ºå·¥å…·è°ƒç”¨è¯·æ±‚
2. **è‡ªåŠ¨è§£æagentType**: ç³»ç»Ÿé¦–å…ˆè§£æagentTypeå­—æ®µï¼Œç¡®å®šè°ƒç”¨ç±»å‹
3. **è·¯ç”±åˆ°å¯¹åº”ç®¡ç†å™¨**: 
   - `mcp`ç±»å‹ â†’ è·¯ç”±åˆ°MCPManagerå¤„ç†
   - `agent`ç±»å‹ â†’ è·¯ç”±åˆ°AgentManagerå¤„ç†
4. **æ‰§è¡Œå·¥å…·è°ƒç”¨**: è°ƒç”¨å¯¹åº”çš„æœåŠ¡æ‰§è¡Œå…·ä½“ä»»åŠ¡
5. **ç»“æœè¿”å›LLM**: å°†å·¥å…·æ‰§è¡Œç»“æœè¿”å›ç»™LLM
6. **å¾ªç¯å¤„ç†**: é‡å¤æ­¥éª¤2-5ï¼Œç›´åˆ°LLMè¾“å‡ºæ™®é€šæ–‡æœ¬æˆ–æ— å·¥å…·è°ƒç”¨

### é…ç½®å‚æ•°
```python
# config.pyä¸­çš„å·¥å…·è°ƒç”¨å¾ªç¯é…ç½®
MAX_handoff_LOOP_STREAM = 5      # æµå¼æ¨¡å¼æœ€å¤§å·¥å…·è°ƒç”¨å¾ªç¯æ¬¡æ•°
MAX_handoff_LOOP_NON_STREAM = 5  # éæµå¼æ¨¡å¼æœ€å¤§å·¥å…·è°ƒç”¨å¾ªç¯æ¬¡æ•°
SHOW_handoff_OUTPUT = False      # æ˜¯å¦æ˜¾ç¤ºå·¥å…·è°ƒç”¨è¾“å‡º
```

---

## ğŸŒ å¤šAgentä¸MCPæœåŠ¡

### åŠ¨æ€æœåŠ¡æ± æŸ¥è¯¢åŠŸèƒ½

#### æ ¸å¿ƒæŸ¥è¯¢æ–¹æ³•
```python
from mcpserver.mcp_registry import (
    get_all_services_info,      # è·å–æ‰€æœ‰æœåŠ¡ä¿¡æ¯
    get_service_info,           # è·å–å•ä¸ªæœåŠ¡è¯¦æƒ…
    query_services_by_capability, # æŒ‰èƒ½åŠ›æœç´¢æœåŠ¡
    get_service_statistics,     # è·å–ç»Ÿè®¡ä¿¡æ¯
    get_available_tools         # è·å–æœåŠ¡å·¥å…·åˆ—è¡¨
)
```

#### APIç«¯ç‚¹
- `GET /mcp/services` - è·å–æ‰€æœ‰æœåŠ¡åˆ—è¡¨å’Œç»Ÿè®¡ä¿¡æ¯
- `GET /mcp/services/{service_name}` - è·å–æŒ‡å®šæœåŠ¡è¯¦æƒ…
- `GET /mcp/services/search/{capability}` - æŒ‰èƒ½åŠ›æœç´¢æœåŠ¡
- `GET /mcp/services/{service_name}/tools` - è·å–æœåŠ¡å·¥å…·åˆ—è¡¨
- `GET /mcp/statistics` - è·å–æœåŠ¡ç»Ÿè®¡ä¿¡æ¯

### å…¸å‹ç”¨æ³•ç¤ºä¾‹
```python
# è¯»å–æ–‡ä»¶å†…å®¹
await s.mcp.handoff(
  service_name="file",
  task={"action": "read", "path": "test.txt"}
)

# è¿è¡ŒPythonä»£ç 
await s.mcp.handoff(
  service_name="coder",
  task={"action": "run", "file": "main.py"}
)
```

---

## ğŸ¤– AgentManager ç‹¬ç«‹ç³»ç»Ÿ

### ç³»ç»Ÿæ¦‚è¿°
AgentManageræ˜¯ä¸€ä¸ªç‹¬ç«‹çš„Agentæ³¨å†Œå’Œè°ƒç”¨ç³»ç»Ÿï¼Œæ”¯æŒä»é…ç½®æ–‡ä»¶åŠ¨æ€åŠ è½½Agentå®šä¹‰ï¼Œæä¾›ç»Ÿä¸€çš„è°ƒç”¨æ¥å£å’Œå®Œæ•´çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†ã€‚

### æ ¸å¿ƒåŠŸèƒ½

#### 1. é…ç½®ç®¡ç†
- **åŠ¨æ€é…ç½®åŠ è½½**: ä»`agent_configs/`ç›®å½•è‡ªåŠ¨æ‰«æå’ŒåŠ è½½Agenté…ç½®æ–‡ä»¶
- **é…ç½®éªŒè¯**: è‡ªåŠ¨éªŒè¯Agenté…ç½®çš„å®Œæ•´æ€§å’Œæœ‰æ•ˆæ€§
- **çƒ­é‡è½½**: æ”¯æŒè¿è¡Œæ—¶é‡æ–°åŠ è½½é…ç½®ï¼Œæ— éœ€é‡å¯ç³»ç»Ÿ
- **ç¯å¢ƒå˜é‡æ”¯æŒ**: æ”¯æŒä»ç¯å¢ƒå˜é‡å’Œ`.env`æ–‡ä»¶åŠ è½½æ•æ„Ÿé…ç½®

#### 2. ä¼šè¯ç®¡ç†
- **å¤šä¼šè¯æ”¯æŒ**: æ¯ä¸ªAgentæ”¯æŒå¤šä¸ªç‹¬ç«‹çš„ä¼šè¯ä¸Šä¸‹æ–‡
- **å†å²è®°å½•**: è‡ªåŠ¨ç»´æŠ¤å¯¹è¯å†å²ï¼Œæ”¯æŒä¸Šä¸‹æ–‡å¬å›
- **ä¼šè¯è¿‡æœŸ**: è‡ªåŠ¨æ¸…ç†è¿‡æœŸçš„ä¼šè¯æ•°æ®ï¼ŒèŠ‚çœå†…å­˜
- **ä¼šè¯éš”ç¦»**: ä¸åŒç”¨æˆ·å’Œä¸åŒAgentçš„ä¼šè¯å®Œå…¨éš”ç¦»

#### 3. æ™ºèƒ½å ä½ç¬¦æ›¿æ¢
æ”¯æŒå¤šç§ç±»å‹çš„å ä½ç¬¦æ›¿æ¢ï¼š

**Agenté…ç½®å ä½ç¬¦**:
- `{{AgentName}}` - Agentåç§°
- `{{Description}}` - æè¿°ä¿¡æ¯
- `{{ModelId}}` - æ¨¡å‹ID
- `{{Temperature}}` - æ¸©åº¦å‚æ•°
- `{{MaxTokens}}` - æœ€å¤§è¾“å‡ºtokenæ•°
- `{{ModelProvider}}` - æ¨¡å‹æä¾›å•†

**ç¯å¢ƒå˜é‡å ä½ç¬¦**:
- `{{ENV_VAR_NAME}}` - ç³»ç»Ÿç¯å¢ƒå˜é‡

**æ—¶é—´å ä½ç¬¦**:
- `{{CurrentTime}}` - å½“å‰æ—¶é—´ (HH:MM:SS)
- `{{CurrentDate}}` - å½“å‰æ—¥æœŸ (YYYY-MM-DD)
- `{{CurrentDateTime}}` - å®Œæ•´æ—¶é—´ (YYYY-MM-DD HH:MM:SS)

### é…ç½®æ–‡ä»¶æ ¼å¼

#### Agenté…ç½®æ–‡ä»¶ç¤ºä¾‹
```json
{
  "ExampleAgent": {
    "model_id": "deepseek-chat",
    "name": "ç¤ºä¾‹åŠ©æ‰‹",
    "base_name": "ExampleAgent",
    "system_prompt": "ä½ æ˜¯{{AgentName}}ï¼Œä¸€ä¸ªä¸“ä¸šçš„{{Description}}ã€‚\n\nå½“å‰æ—¶é—´ï¼š{{CurrentDateTime}}\næ¨¡å‹ï¼š{{ModelId}}\næ¸©åº¦ï¼š{{Temperature}}\n\nè¯·ç”¨ä¸­æ–‡å›ç­”ï¼Œä¿æŒä¸“ä¸šå’Œå‹å¥½çš„æ€åº¦ã€‚",
    "max_output_tokens": 8192,
    "temperature": 0.7,
    "description": "æ™ºèƒ½åŠ©æ‰‹ï¼Œæ“…é•¿å›ç­”å„ç§é—®é¢˜",
    "model_provider": "openai",
    "api_base_url": "https://api.deepseek.com/v1",
    "api_key": "{{DEEPSEEK_API_KEY}}"
  }
}
```

### ä½¿ç”¨ç¤ºä¾‹

#### åŸºæœ¬è°ƒç”¨
```python
from agentserver.core.agent_manager import get_agent_manager

# è·å–AgentManagerå®ä¾‹
agent_manager = get_agent_manager()

# è°ƒç”¨Agent
result = await agent_manager.call_agent(
    agent_name="ExampleAgent",
    prompt="è¯·å¸®æˆ‘åˆ†æè¿™ä»½æ•°æ®",
    session_id="user_123"
)
```

#### ä¾¿æ·å‡½æ•°è°ƒç”¨
```python
from agentserver.core.agent_manager import call_agent, list_agents, get_agent_info

# ä¾¿æ·è°ƒç”¨
result = await call_agent("ExampleAgent", "ä½ å¥½")

# è·å–Agentåˆ—è¡¨
agents = list_agents()
```

---

## ğŸ“‹ Agent Manifestæ ‡å‡†åŒ–

### æ ‡å‡†åŒ–è§„èŒƒ
æ‰€æœ‰Agentå¿…é¡»ä½¿ç”¨æ ‡å‡†åŒ–çš„`agent-manifest.json`é…ç½®æ–‡ä»¶ï¼Œç¡®ä¿ä¸€è‡´æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚

#### å¿…éœ€å­—æ®µ
- `name`: Agentå”¯ä¸€æ ‡è¯†ç¬¦
- `displayName`: æ˜¾ç¤ºåç§°
- `version`: ç‰ˆæœ¬å·ï¼ˆx.y.zæ ¼å¼ï¼‰
- `description`: åŠŸèƒ½æè¿°
- `author`: ä½œè€…æˆ–æ¨¡å—åç§°
- `agentType`: Agentç±»å‹ï¼ˆmcp/agentï¼‰
- `entryPoint`: å…¥å£ç‚¹é…ç½®ï¼ˆmoduleå’Œclassï¼‰

### åˆ›å»ºæ–°Agent

#### åˆ›å»ºMCPç±»å‹Agent
1. åœ¨`mcpserver/`ç›®å½•ä¸‹åˆ›å»ºæ–°çš„Agentç›®å½•
2. å¤åˆ¶`AGENT_MANIFEST_TEMPLATE.json`åˆ°Agentç›®å½•
3. ä¿®æ”¹manifestæ–‡ä»¶å†…å®¹
4. åˆ›å»ºAgentå®ç°ç±»
5. é‡å¯ç³»ç»Ÿè‡ªåŠ¨æ³¨å†Œ

#### åˆ›å»ºAgentç±»å‹Agent
1. åœ¨`agent_configs/`ç›®å½•ä¸‹åˆ›å»ºé…ç½®æ–‡ä»¶
2. å®šä¹‰Agenté…ç½®ï¼ˆæ¨¡å‹ã€æç¤ºè¯ç­‰ï¼‰
3. é…ç½®ç¯å¢ƒå˜é‡ï¼ˆAPIå¯†é’¥ç­‰ï¼‰
4. é‡å¯ç³»ç»Ÿè‡ªåŠ¨åŠ è½½

---

## ğŸ¤ è´¡çŒ®æŒ‡å—

æˆ‘ä»¬æ¬¢è¿æ‰€æœ‰å½¢å¼çš„è´¡çŒ®ï¼è¯·é˜…è¯»ä»¥ä¸‹æŒ‡å—ï¼š

### ğŸ“‹ è´¡çŒ®æ–¹å¼
- **æŠ¥å‘Šé—®é¢˜**: ä½¿ç”¨ GitHub Issues æäº¤ Bug æŠ¥å‘Š
- **åŠŸèƒ½å»ºè®®**: æå‡ºæ–°åŠŸèƒ½çš„éœ€æ±‚å’Œå»ºè®®
- **ä»£ç è´¡çŒ®**: æäº¤ Pull Request æ”¹è¿›ä»£ç 
- **æ–‡æ¡£æ”¹è¿›**: å®Œå–„é¡¹ç›®æ–‡æ¡£å’Œä½¿ç”¨è¯´æ˜

### ğŸ“ å¼€å‘è§„èŒƒ
- éµå¾ª PEP 8 ä»£ç é£æ ¼
- æ·»åŠ é€‚å½“çš„æ³¨é‡Šå’Œæ–‡æ¡£
- ç¡®ä¿ä»£ç æµ‹è¯•é€šè¿‡
- æ›´æ–°ç›¸å…³æ–‡æ¡£

### ğŸ“ è”ç³»æ–¹å¼
- **Issues**: [GitHub Issues](https://github.com/Xxiii8322766509/NagaAgent/issues)
- **è®¨è®º**: [GitHub Discussions](https://github.com/Xxiii8322766509/NagaAgent/discussions)

---

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ - è¯¦è§ [LICENSE](LICENSE) æ–‡ä»¶

<div align="center">

---

**â­ å¦‚æœè¿™ä¸ªé¡¹ç›®å¯¹æ‚¨æœ‰å¸®åŠ©ï¼Œè¯·è€ƒè™‘ç»™æˆ‘ä»¬ä¸€ä¸ª Starï¼**

</div>
